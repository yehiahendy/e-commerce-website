{"version":3,"file":"Input.js","sourceRoot":"","sources":["../src/Input.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport * as PropTypes from 'prop-types';\n\nimport { Field } from './Field';\nimport { FormWithConstraints, FormWithConstraintsChildContext } from './FormWithConstraints';\n\nexport interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n  innerRef?: React.Ref<HTMLInputElement>;\n  classes: {\n    [index: string]: string | undefined;\n    isPending?: string;\n    hasErrors?: string;\n    hasWarnings?: string;\n    hasInfos?: string;\n    isValid?: string;\n  };\n}\n\ninterface InputState {\n  field: undefined | 'pending' | Field;\n}\n\nexport type InputContext = FormWithConstraintsChildContext;\n\nexport class Input extends React.Component<InputProps, InputState> {\n  static contextTypes: React.ValidationMap<InputContext> = {\n    form: PropTypes.instanceOf(FormWithConstraints).isRequired\n  };\n  context!: InputContext;\n\n  static defaultProps: InputProps = {\n    classes: {\n      isPending: 'is-pending',\n      hasErrors: 'has-errors',\n      hasWarnings: 'has-warnings',\n      hasInfos: 'has-infos',\n      isValid: 'is-valid'\n    }\n  };\n\n  state: InputState = {\n    field: undefined\n  };\n\n  /* eslint-disable react/destructuring-assignment */\n\n  componentDidMount() {\n    this.context.form.addFieldWillValidateEventListener(this.fieldWillValidate);\n    this.context.form.addFieldDidValidateEventListener(this.fieldDidValidate);\n    this.context.form.addFieldDidResetEventListener(this.fieldDidReset);\n  }\n\n  componentWillUnmount() {\n    this.context.form.removeFieldWillValidateEventListener(this.fieldWillValidate);\n    this.context.form.removeFieldDidValidateEventListener(this.fieldDidValidate);\n    this.context.form.removeFieldDidResetEventListener(this.fieldDidReset);\n  }\n\n  fieldWillValidate = (fieldName: string) => {\n    // Ignore the event if it's not for us\n    if (fieldName === this.props.name) {\n      this.setState({ field: 'pending' });\n    }\n  };\n\n  fieldDidValidate = (field: Field) => {\n    // Ignore the event if it's not for us\n    if (field.name === this.props.name) {\n      this.setState({ field });\n    }\n  };\n\n  fieldDidReset = (field: Field) => {\n    // Ignore the event if it's not for us\n    if (field.name === this.props.name) {\n      this.setState({ field: undefined });\n    }\n  };\n\n  /* eslint-enable react/destructuring-assignment */\n\n  fieldValidationStates() {\n    const { field } = this.state;\n\n    const states = [];\n\n    if (field !== undefined) {\n      if (field === 'pending') {\n        states.push('isPending');\n      } else {\n        if (field.hasErrors()) states.push('hasErrors');\n        if (field.hasWarnings()) states.push('hasWarnings');\n        if (field.hasInfos()) states.push('hasInfos');\n        if (field.isValid()) states.push('isValid');\n      }\n    }\n\n    return states;\n  }\n\n  render() {\n    const { innerRef, className, classes, ...inputProps } = this.props;\n    const validationStates = this.fieldValidationStates();\n\n    let classNames = className;\n    validationStates.forEach(validationState => {\n      const tmp = classes![validationState];\n      if (tmp !== undefined) {\n        if (classNames !== undefined) {\n          classNames += ` ${tmp}`;\n        } else {\n          classNames = tmp;\n        }\n      }\n    });\n\n    return <input ref={innerRef} {...inputProps} className={classNames} />;\n  }\n}\n"]}